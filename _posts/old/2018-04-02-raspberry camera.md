---
layout:
title: 라즈베리파이 로 영상처리하기
modified:
categories:
excerpt:
tags: []
image:
  feature:
---

# raspberry pi 영상처리하기
- 왜?
- 카메라 연결
- opencv를 통한 영상취득

# 1. Why?

- 나는 회사에서 영상처리를 한다. (아마도?) 혹은 데이터 분석을 한다. 분명 이걸하다보면 스트레스를 받아서 스트레스를 해소할 필요가있겟지. 그래서 취미를 만드는 것은 정말 중요하다.
  - 나는 취미로 뭔가 만들고 싶다. 내가 만들 수 있는 능력이 뭐있지? 기계학습? 딥러닝? 이런걸 이용해서 뭔가 신기한 어플리케이션을 만드는게 다이다. 그렇다면 ? 직장에서하는 일과 집에서 취미로하려는 일이 같아지게된다.
  - 페북을 돌아다니다 정신 노동자가 체력을 회복하고, 휴식을 취하는 것은 '생활의 변화', '다른 신경세포를 자극' 하는 것이 라는 글을 보았다. 요즘도 그런생각이 들고있다. 뭔가 생산성있는, 재미잇는 일을 해보자고 주말에 개발을 하는데 결국 이것은 평일에 회사에서 작업하던것과 일맥상통한 것들이다. 이래선 안된다. 뭔가 다른것을 새로운 것을 해야겠다는 생각이 들었다.

- 그래서. 시작한다. '하드웨어'. 일단은 시작은 라즈베리파이 이다. 또한 '딥러닝'도 하지않을 생각이다. 순수 영상처리 알고리즘만 활용해서 뭔가 신기한 제품을 만들고 싶다.
  - 라즈베리파이와 라즈베리파이 카메라로 충분히 즐기고 난 이후에는 자동으로 상하좌우 움직이는 카메라를 사다가 작동시켜보는 것이 목표다. 일반적으로 머신비전, 영상처리는 외부로부터 정보를 얻어내는데서 그친다는 생각이 많이든다. 하지만 영상을 취득하고, 그것에 기반해서 바로 반응하는, 뭔가 능동적인 알고리즘을 만들어낸다면 아주 재미있을 것 같다. 그래서 일단은, 라즈베리파이와 카메라로 '하드웨어로서의 카메라'와 아주조금 친해진 다음 (사실 회전되는 cctv살 돈도없다. 월급나오면 usb로 연결가능한거 사면될듯)

- 이쪽은 서론이 더 긴듯..
  - 결론
  - 직장에서 알고리즘을 개발하는데, 집에서까지 알고리즘을 개발하면 스트레스가 너무 쌓인다
  - 하드웨어를 개발하자
    - 일단 라즈베리파이와 카메라에서 시작 (그래도 카메라쪽이 내가 할줄 아는거니까)
    - 그리고 5만원 언저리의 전동으로 움직일 수 있는 CCTV사서 뭔가 해보자.


# 2. 라즈베리파이 카메라 연결
- 이건뭐. 별로 어렵지 않음.
- ```sudo raspi-config``` 여기로 들어가서 카메라 ```enable```만들어줘야 일단 라즈베리파이 카메라 연결이 됨.

## 2.1. 사진 찍어보기.
- OpenCV를 쓰지않고, 일단 카메라가 동작하는지 보기 위해서 사진을 찍어보자
  - 터미널에서 이명령어를 치면, 카메라가 잘 붙었다면, 사진이 찍힐 것이다. (라즈베리파이 카메라 쓸데없이 화질이 너무좋음, 그에반해 fps는 되게 후짐)

```
raspistill -o pic.jpg
```


- 이번엔 OpenCV로 영상을 찍어보자
  - 일단 'usb카메라'처럼 장치 인식을 시켜줘야한다. 그래야 OpenCV로 접근 가능 ```ls /dev/vidio*``` 쳐보면 카메라음슴.

```
sudo modprobe bcm2835 -v412
```

- 일단 이러면, 장치가 인식이 됨. ```ls /dev/vidio*``` 이젠 카메라 있음
  - 아마도, 이 작업은 부팅때마다 해줘야하는거 같음. ```etc/modules``` 파일에 드라이버 이름 등록해놓자. 마지막줄에 ```bcm2835-v412```를 넣어준다.
- 이제 OpenCV로 코딩을 시작해보자.

```python
import cv2
cap = cv2.VideoCapture(0)

while cap.isOpened():
  ret, img = cap.read()
  if ret:
    cv2.imshow('camera-0', img)
    if cv2.waitkey(1) & 0xFF == 27: # esc
      break
```
